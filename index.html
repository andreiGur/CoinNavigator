<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinNavigator | Crypto Arbitrage Opportunities in Real Time</title>
    <meta name="description" content="Compare crypto prices across top exchanges, learn how arbitrage works, and choose the right exchange with trustworthy, transparent recommendations." />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="#0b0f1a" />

    <link rel="canonical" href="https://www.coinnavigator.net/" />
    <meta property="og:site_name" content="CoinNavigator" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="CoinNavigator | Crypto Arbitrage Opportunities in Real Time" />
    <meta property="og:description" content="Compare crypto prices across top exchanges, learn how arbitrage works, and choose the right exchange with trustworthy, transparent recommendations." />
    <meta property="og:url" content="https://www.coinnavigator.net/" />
    <meta name="twitter:card" content="summary" />

    <!-- Optional analytics: add your GA4 Measurement ID (e.g. G-XXXXXXX) to enable tracking -->
    <meta name="coinnavigator-ga4" content="" />

    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #0f172a;
            --accent: #10b981;
            --bg: #0b0f1a;
            --card-bg: #161b2a;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #2d334a;
            --danger: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg); 
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }
        html { scroll-behavior: smooth; }

        /* Animated Background */
        .bg-glow {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }

        .bg-grid {
            position: fixed;
            inset: 0;
            background-image:
              linear-gradient(to right, rgba(255,255,255,0.05) 1px, transparent 1px),
              linear-gradient(to bottom, rgba(255,255,255,0.04) 1px, transparent 1px);
            background-size: 80px 80px;
            opacity: 0.15;
            z-index: -2;
            pointer-events: none;
            mask-image: radial-gradient(circle at 50% 30%, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 65%);
        }

        /* Subtle entrance animation */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Navigation */
        nav {
            background: rgba(11, 15, 26, 0.8);
            backdrop-filter: blur(12px);
            padding: 1.25rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid var(--border);
        }
        .logo { font-size: 1.5rem; font-weight: 800; color: white; text-decoration: none; display: flex; align-items: center; gap: 12px; }
        .logo i { color: var(--primary); }
        
        .nav-links { display: flex; gap: 2.5rem; list-style: none; }
        .nav-links a { text-decoration: none; color: var(--text-muted); font-weight: 500; font-size: 0.9rem; transition: all 0.2s; }
        .nav-links a:hover { color: var(--primary-light); }

        .nav-cta { display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; justify-content: flex-end; }

        .select {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.10);
            color: var(--text-main);
            border-radius: 12px;
            padding: 0.65rem 0.85rem;
            font-weight: 800;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
        }

        .btn {
            border: 1px solid transparent;
            border-radius: 12px;
            font-weight: 700;
            padding: 0.75rem 1.1rem;
            font-size: 0.9rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.2s, background 0.2s, border-color 0.2s, color 0.2s;
            will-change: transform;
            cursor: pointer;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-light); }
        .btn-ghost { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.1); color: var(--text-main); }
        .btn-ghost:hover { border-color: rgba(129, 140, 248, 0.7); }
        
        /* Hero Section */
        .hero {
            padding: 6rem 2rem;
            text-align: center;
            position: relative;
        }
        .hero h1 { 
            font-size: 4rem; font-weight: 800; letter-spacing: -0.02em; margin-bottom: 1.5rem;
            background: linear-gradient(to right, #fff, #94a3b8);
            background-clip: text;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .hero p { color: var(--text-muted); font-size: 1.25rem; max-width: 700px; margin: 0 auto 2.5rem; }

        .hero-cta {
            display: flex;
            justify-content: center;
            gap: 0.9rem;
            flex-wrap: wrap;
            animation: fadeUp 700ms ease-out 120ms both;
        }

        .trust-row {
            margin-top: 1.5rem;
            color: var(--text-muted);
            font-size: 0.9rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            opacity: 0.9;
        }
        .pill {
            border: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.03);
            padding: 0.4rem 0.75rem;
            border-radius: 999px;
            display: inline-flex;
            gap: 8px;
            align-items: center;
        }
        .pill i { color: var(--accent); }

        /* Stats Cards */
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem; max-width: 1200px; margin: -3rem auto 3rem; padding: 0 2rem;
        }
        .stat-card {
            background: var(--card-bg); border: 1px solid var(--border);
            padding: 1.5rem; border-radius: 16px; text-align: center;
            animation: fadeUp 650ms ease-out both;
            transition: transform 0.2s, border-color 0.2s;
        }
        .stat-card:hover { transform: translateY(-3px); border-color: rgba(129, 140, 248, 0.55); }
        a.stat-card { text-decoration: none; color: inherit; display: block; }
        .stat-card h4 { color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 0.5rem; }
        .stat-card .value { font-size: 1.5rem; font-weight: 700; color: var(--accent); }

        /* Clickable affordance */
        .clickable { cursor: pointer; }
        .clickable:hover { border-color: rgba(129, 140, 248, 0.65); }
        .focus-ring:focus-visible {
            outline: 2px solid rgba(129, 140, 248, 0.85);
            outline-offset: 3px;
            border-radius: 14px;
        }
        .link-mini {
            color: var(--text-main);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 0.35rem 0.55rem;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.02);
            transition: transform 0.2s, border-color 0.2s, background 0.2s;
            width: fit-content;
            max-width: 100%;
            white-space: normal;
        }
        .link-mini:hover { transform: translateY(-2px); border-color: rgba(129, 140, 248, 0.7); }

        /* Main Dashboard */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        
        .dashboard-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: fadeUp 650ms ease-out 50ms both;
        }

        .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .live-indicator { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: var(--accent); font-weight: 600; }
        .dot { height: 8px; width: 8px; background: var(--accent); border-radius: 50%; animation: pulse 2s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th { text-align: left; padding: 1.25rem; color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid var(--border); }
        td { padding: 1.5rem 1.25rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        
        .symbol-box { display: flex; align-items: center; gap: 12px; }
        .symbol-box .name { font-weight: 700; font-size: 1.1rem; }
        
        .price-val { font-family: 'JetBrains Mono', monospace; font-weight: 500; }
        .spread-val { 
            background: rgba(16, 185, 129, 0.1); color: var(--accent); 
            padding: 0.5rem 1rem; border-radius: 12px; font-weight: 700; 
        }

        .btn-trade {
            background: var(--primary); color: white; text-decoration: none;
            padding: 0.6rem 1.2rem; border-radius: 10px; font-size: 0.85rem; font-weight: 600;
            transition: all 0.2s; display: inline-block;
        }
        .btn-trade:hover { background: var(--primary-light); transform: translateY(-2px); }

        .btn-mini {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            color: var(--text-main);
            padding: 0.55rem 0.9rem;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 700;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, border-color 0.2s, background 0.2s;
            white-space: normal;
            line-height: 1.15;
        }
        .btn-mini:hover { transform: translateY(-2px); border-color: rgba(129, 140, 248, 0.7); }
        .btn-mini-primary { background: rgba(99,102,241,0.18); border-color: rgba(99,102,241,0.35); }

        .row-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .details-row td { padding-top: 0; }
        .details {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px;
            padding: 1rem;
            margin: 0.75rem 0 1.25rem;
        }
        .details-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 0.75rem;
        }
        .details-item {
            border: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.02);
            border-radius: 14px;
            padding: 0.75rem 0.85rem;
            display: flex;
            justify-content: space-between;
            gap: 10px;
            align-items: center;
        }
        .details-item .ex { color: var(--text-muted); font-weight: 700; font-size: 0.82rem; letter-spacing: 0.04em; text-transform: uppercase; }
        .details-item .val { font-family: 'JetBrains Mono', monospace; font-weight: 700; }
        .muted { color: var(--text-muted); }
        .err { color: var(--danger); font-weight: 700; }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            display: none;
            z-index: 2000;
        }
        .modal.open { display: block; }
        .modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(6px);
        }
        .modal-card {
            position: relative;
            max-width: 720px;
            margin: 8vh auto;
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.10);
            border-radius: 20px;
            box-shadow: 0 30px 90px rgba(0,0,0,0.55);
            padding: 1.25rem;
            animation: fadeUp 240ms ease-out;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding-bottom: 0.9rem;
            margin-bottom: 0.9rem;
        }
        .modal-title { font-weight: 800; letter-spacing: -0.02em; }
        .modal-close {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.10);
            color: var(--text-main);
            border-radius: 12px;
            padding: 0.55rem 0.75rem;
            font-weight: 800;
            cursor: pointer;
        }
        .modal-body { color: var(--text-muted); }
        .modal-steps { margin-top: 0.75rem; display: grid; gap: 0.6rem; }
        .step {
            border: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.02);
            border-radius: 14px;
            padding: 0.85rem;
            display: flex;
            gap: 0.75rem;
        }
        .step .num {
            width: 28px; height: 28px;
            display: inline-flex;
            align-items: center; justify-content: center;
            border-radius: 10px;
            background: rgba(99,102,241,0.20);
            border: 1px solid rgba(99,102,241,0.35);
            color: white;
            font-weight: 800;
            flex: 0 0 auto;
        }
        .step .txt { color: var(--text-main); font-weight: 600; }
        .modal-footer { margin-top: 1rem; display: flex; gap: 0.75rem; flex-wrap: wrap; }

        /* Affiliate CTA section */
        .cta-section { margin-top: 2.5rem; }
        .cta-card {
            background: linear-gradient(135deg, rgba(99,102,241,0.16), rgba(16,185,129,0.08));
            border: 1px solid rgba(129,140,248,0.35);
            border-radius: 24px;
            padding: 2rem;
            overflow: hidden;
            position: relative;
        }
        .cta-card:before {
            content: "";
            position: absolute;
            inset: -2px;
            background: radial-gradient(circle at 10% 10%, rgba(129,140,248,0.22), transparent 40%),
                        radial-gradient(circle at 90% 30%, rgba(16,185,129,0.18), transparent 45%);
            filter: blur(10px);
            opacity: 0.8;
            pointer-events: none;
        }
        .cta-inner { position: relative; display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 1.5rem; align-items: center; }
        .cta-inner h3 { font-size: 1.8rem; letter-spacing: -0.02em; }
        .cta-inner p { color: var(--text-muted); margin-top: 0.6rem; }
        .cta-buttons { display: flex; flex-wrap: wrap; gap: 0.75rem; justify-content: flex-end; }

        /* News Section */
        .news-section { margin-top: 6rem; }
        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .news-card {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 16px; overflow: hidden; transition: transform 0.3s;
        }
        .news-card:hover { transform: translateY(-5px); }
        a.card-link { display: block; text-decoration: none; color: inherit; }
        .news-content { padding: 1.5rem; }
        .news-tag { color: var(--primary-light); font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .news-title { font-size: 1.1rem; font-weight: 600; margin: 0.5rem 0 1rem; }
        .news-link { color: var(--text-muted); text-decoration: none; font-size: 0.85rem; display: flex; align-items: center; gap: 5px; }

        /* Polymarket module */
        .pm-section { margin-top: 4rem; }
        .pm-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1rem; margin-top: 1.25rem; }
        .pm-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 18px;
            padding: 1.1rem;
            transition: transform 0.25s, border-color 0.2s;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            min-height: 210px;
        }
        .pm-card:hover { transform: translateY(-4px); border-color: rgba(129, 140, 248, 0.55); }
        .pm-q { font-weight: 900; letter-spacing: -0.01em; line-height: 1.25; }
        .pm-meta { color: var(--text-muted); font-size: 0.9rem; display: flex; flex-wrap: wrap; gap: 0.4rem 0.9rem; }
        .pm-chips { display: flex; gap: 0.6rem; flex-wrap: wrap; }
        .pm-chip {
            padding: 0.35rem 0.55rem;
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            font-weight: 900;
            font-size: 0.85rem;
        }
        .pm-actions { margin-top: auto; display: flex; gap: 0.6rem; flex-wrap: wrap; }

        footer { text-align: center; padding: 6rem 2rem; color: var(--text-muted); font-size: 0.9rem; }
        .footer-links {
            margin-top: 1.25rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem 1.25rem;
            justify-content: center;
        }
        .footer-links a { color: var(--text-muted); text-decoration: none; font-weight: 700; font-size: 0.9rem; }
        .footer-links a:hover { color: var(--primary-light); }

        /* Education block (Phase 1) */
        .edu-section { margin-top: 2.5rem; }
        .edu-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 24px;
            padding: 1.75rem;
        }
        .edu-grid { display: grid; grid-template-columns: 1.05fr 0.95fr; gap: 1.25rem; align-items: start; margin-top: 1rem; }
        .flow {
            display: grid;
            gap: 0.75rem;
        }
        .flow-step {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            padding: 0.85rem;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.02);
        }
        a.flow-step { text-decoration: none; color: inherit; }
        .flow-step .badge {
            width: 34px; height: 34px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center; justify-content: center;
            background: rgba(99,102,241,0.18);
            border: 1px solid rgba(99,102,241,0.35);
            color: white;
            font-weight: 900;
            flex: 0 0 auto;
        }
        .flow-step .title { font-weight: 900; letter-spacing: -0.01em; }
        .flow-step .sub { color: var(--text-muted); font-size: 0.9rem; }
        .example {
            border: 1px solid rgba(16,185,129,0.25);
            background: rgba(16,185,129,0.06);
            border-radius: 18px;
            padding: 1rem 1.1rem;
        }
        .example h4 { font-size: 1rem; margin-bottom: 0.5rem; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        @media (max-width: 768px) {
            .hero h1 { font-size: 2.5rem; }
            .nav-links { display: none; }
            nav { padding: 1rem 1rem; }
            .nav-cta { gap: 0.5rem; }
            .btn { padding: 0.7rem 0.95rem; }
            .stats-grid { margin-top: -2rem; }
            .dashboard-card { padding: 1.25rem; }
            th, td { padding: 1rem 0.75rem; }
            .details-grid { grid-template-columns: 1fr; }
            .cta-inner { grid-template-columns: 1fr; }
            .cta-buttons { justify-content: flex-start; }

            /* On mobile: compact table (no horizontal scroll) */
            th:nth-child(2), td:nth-child(2) { display: none; } /* Buy */
            th:nth-child(3), td:nth-child(3) { display: none; } /* Sell */

            .edu-grid { grid-template-columns: 1fr; }

            /* Avoid overflow from action buttons */
            .btn-mini { padding: 0.5rem 0.7rem; font-size: 0.82rem; }
            .row-actions { gap: 0.4rem; }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-glow"></div>

    <nav>
        <a href="/" class="logo"><i class="fas fa-bolt"></i> CoinNavigator</a>
        <ul class="nav-links">
            <li><a href="#dashboard">Market Spreads</a></li>
            <li><a href="#learn">Learn</a></li>
            <li><a href="/polymarket/">Polymarket</a></li>
            <li><a href="/binance-review/">Exchanges</a></li>
            <li><a href="/about/">About</a></li>
            <li><a href="/contact/">Contact</a></li>
        </ul>
        <div class="nav-cta">
            <select class="select" id="region-select" aria-label="Select region">
                <option value="EU">Europe</option>
                <option value="RU">Russia</option>
                <option value="US">USA</option>
                <option value="ASIA">Asia</option>
            </select>
            <a href="#dashboard" class="btn btn-primary" data-track="nav_start"><i class="fas fa-rocket"></i> Start Exploring Spreads</a>
        </div>
    </nav>

    <header class="hero">
        <h1>Find Crypto Arbitrage Opportunities in Real Time</h1>
        <p>Compare prices across top exchanges and track crowd-based probabilities (Polymarket) — with transparent data, beginner-friendly explanations, and trusted recommendations.</p>

        <div class="hero-cta" id="start">
            <a class="btn btn-primary" href="#dashboard" data-track="hero_start"><i class="fas fa-bolt"></i> Start Exploring Spreads</a>
        </div>

        <div class="trust-row">
            <span class="pill"><i class="fas fa-shield-halved"></i> Transparent methodology</span>
            <span class="pill"><i class="fas fa-database"></i> Data sourced from exchange APIs</span>
            <span class="pill"><i class="fas fa-clock"></i> Updates every 15 minutes</span>
        </div>
    </header>

    <div class="stats-grid">
        <a class="stat-card clickable focus-ring" href="#dashboard" title="Open dashboard">
            <h4>Total Assets</h4>
            <div class="value" id="asset-count">9</div>
        </a>
        <a class="stat-card clickable focus-ring" href="#dashboard" title="See current top spreads">
            <h4>Highest Spread</h4>
            <div class="value" id="max-spread">--</div>
        </a>
        <a class="stat-card clickable focus-ring" href="#dashboard" title="View update cadence and latest timestamp">
            <h4>Update Frequency</h4>
            <div class="value">15m</div>
        </a>
        <a class="stat-card clickable focus-ring" href="/about/" title="How the data works (transparency)">
            <h4>API Status</h4>
            <div class="value" style="color: var(--accent)">ONLINE</div>
        </a>
    </div>

    <main class="container">
        <section class="edu-section" id="how-it-works">
            <div class="edu-card">
                <div class="table-header" style="margin-bottom: 0.75rem;">
                    <h2>How Arbitrage Works (Simple)</h2>
                    <div class="live-indicator" style="color: var(--text-muted);">
                        <i class="fas fa-circle-info"></i> Education first. Not financial advice.
                    </div>
                </div>
                <div class="edu-grid">
                    <div class="flow">
                        <a class="flow-step clickable focus-ring" href="#bonuses" title="See recommended exchanges">
                            <div class="badge">1</div>
                            <div>
                                <div class="title">Buy</div>
                                <div class="sub">Buy the asset on the cheaper exchange.</div>
                            </div>
                        </a>
                        <a class="flow-step clickable focus-ring" href="/terms/" title="Understand fees, risks and limits">
                            <div class="badge">2</div>
                            <div>
                                <div class="title">Transfer</div>
                                <div class="sub">Move the asset (or use the same venue if possible). Watch fees & time.</div>
                            </div>
                        </a>
                        <a class="flow-step clickable focus-ring" href="#dashboard" title="Open live opportunities">
                            <div class="badge">3</div>
                            <div>
                                <div class="title">Sell</div>
                                <div class="sub">Sell on the more expensive exchange. Spreads can disappear quickly.</div>
                            </div>
                        </a>
                    </div>
                    <div class="example">
                        <h4>Numeric Example</h4>
                        <div class="muted" style="margin-bottom: 0.5rem;">A spread is only useful if it survives fees + slippage + transfer time.</div>
                        <div class="mono" style="line-height: 1.8;">
                            Buy BTC at <b>$40,000</b><br/>
                            Sell BTC at <b>$40,600</b><br/>
                            Gross spread: <b>$600</b> (1.50%)<br/>
                            Fees + slippage (example): <b>$180</b><br/>
                            Estimated net: <b>$420</b>
                        </div>
                        <div class="muted" style="margin-top: 0.6rem; font-size: 0.9rem;">
                            Tip: start small, track withdrawals, and understand KYC/limits.
                        </div>
                    </div>
                </div>
        </div>
    </section>
    
        <div class="dashboard-card" id="dashboard">
            <div class="table-header">
                <h2>Live Spread Monitor</h2>
                <div class="live-indicator">
                    <div class="dot"></div>
                    LIVE DATA
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Asset</th>
                            <th>Best Buy</th>
                            <th>Best Sell</th>
                            <th>Best Spread</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="spread-body">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 4rem;">
                                <i class="fas fa-circle-notch fa-spin" style="font-size: 2rem; color: var(--primary);"></i>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="timestamp" style="text-align: right; margin-top: 1.5rem; color: var(--text-muted); font-size: 0.8rem;"></div>
        </div>

        <section class="pm-section" id="polymarket">
            <div class="table-header">
                <h2>Polymarket Hot Events (High 24h Volume)</h2>
                <div class="live-indicator" style="color: var(--text-muted);">
                    <i class="fas fa-chart-pie"></i> Market sentiment — not gambling content
                </div>
            </div>
            <div class="muted" style="margin-top: -0.75rem;">
                We highlight high-attention events so you can understand what the crowd expects. Informational only.
            </div>
            <div class="pm-grid" id="pm-grid">
                <div class="pm-card">
                    <div class="pm-q">Loading Polymarket events…</div>
                    <div class="pm-meta">If this takes too long, the data file may still be updating.</div>
                </div>
            </div>
            <div class="muted" id="pm-updated" style="text-align: right; margin-top: 0.75rem; font-size: 0.85rem;"></div>
            <div style="margin-top: 1rem; display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <a class="btn btn-primary" href="/polymarket/" data-track="pm_open_hub"><i class="fas fa-fire"></i> Open Polymarket Hub</a>
                <a class="btn btn-ghost" href="/terms/" data-track="open_terms"><i class="fas fa-shield-halved"></i> Disclosures & risk</a>
            </div>
        </section>

        <section class="cta-section" id="bonuses">
            <div class="cta-card">
                <div class="cta-inner">
                    <div>
                        <h3>Recommended exchanges for your region (with context)</h3>
                        <p>We don’t drop raw affiliate links. First, read a short review explaining who the exchange is for and why it’s recommended. Region: <b id="region-label">—</b></p>
                    </div>
                    <div class="cta-buttons">
                        <a class="btn btn-primary" id="rec-1" href="/binance-review/" data-track="rec_exchange" data-ex="Binance"><i class="fas fa-building-columns"></i> Binance Review</a>
                        <a class="btn btn-ghost" id="rec-2" href="/okx-for-beginners/" data-track="rec_exchange" data-ex="OKX"><i class="fas fa-building-columns"></i> OKX for Beginners</a>
                        <a class="btn btn-ghost" id="rec-3" href="/bybit-arbitrage/" data-track="rec_exchange" data-ex="Bybit"><i class="fas fa-building-columns"></i> Bybit & Arbitrage</a>
                    </div>
            </div>
        </div>
    </section>
    
        <section class="news-section" id="learn">
            <div class="table-header">
                <h2>Beginner Hub</h2>
            </div>
            <div class="news-grid">
                <div class="news-card">
                    <a class="card-link focus-ring" href="#how-it-works" title="Learn the basics">
                        <div class="news-content">
                            <div class="news-tag">Getting Started</div>
                            <h3 class="news-title">What is a spread — and why it matters</h3>
                            <div class="news-link">Read Guide <i class="fas fa-arrow-right"></i></div>
                        </div>
                    </a>
                </div>
                <div class="news-card">
                    <a class="card-link focus-ring" href="/terms/" title="Safety checklist and risk notes">
                        <div class="news-content">
                            <div class="news-tag">Safety</div>
                            <h3 class="news-title">How to avoid common beginner mistakes</h3>
                            <div class="news-link">Open Checklist <i class="fas fa-arrow-right"></i></div>
                        </div>
                    </a>
                </div>
                <div class="news-card">
                    <a class="card-link focus-ring" href="/binance-review/" data-regionize="1" title="Compare exchanges (with context)">
                        <div class="news-content">
                            <div class="news-tag">Tools</div>
                            <h3 class="news-title">Best exchanges for new traders (fees, UX, support)</h3>
                            <div class="news-link">Compare <i class="fas fa-arrow-right"></i></div>
                        </div>
                    </a>
                </div>
            </div>
        </section>

        <section class="news-section" id="news">
            <div class="table-header">
                <h2>Market Intelligence</h2>
            </div>
            <div class="news-grid">
                <div class="news-card">
                    <a class="card-link focus-ring" href="/binance-review/" data-regionize="1" title="Recommended exchange context (Binance)">
                        <div class="news-content">
                            <div class="news-tag">Market Analysis</div>
                            <h3 class="news-title">Bitcoin Consolidation: Key Levels to Watch in Q1 2026</h3>
                            <div class="news-link">Read Analysis <i class="fas fa-arrow-right"></i></div>
                        </div>
                    </a>
                </div>
                <div class="news-card">
                    <a class="card-link focus-ring" href="/okx-for-beginners/" data-regionize="1" title="Arbitrage tips + beginner-friendly exchange">
                        <div class="news-content">
                            <div class="news-tag">Arbitrage Tips</div>
                            <h3 class="news-title">How to minimize slippage during high-spread events</h3>
                            <div class="news-link">View Guide <i class="fas fa-arrow-right"></i></div>
                        </div>
                    </a>
                </div>
                <div class="news-card">
                    <a class="card-link focus-ring" href="/bybit-arbitrage/" data-regionize="1" title="Ecosystem update + exchange context">
                        <div class="news-content">
                            <div class="news-tag">Ecosystem</div>
                            <h3 class="news-title">ByBit increases liquidity for SOL/USDT trading pairs</h3>
                            <div class="news-link">Read More <i class="fas fa-arrow-right"></i></div>
                </div>
                    </a>
            </div>
        </div>
    </section>
        </div>
    
    <footer>
        <p>&copy; 2026 CoinNavigator | Built for trust-first crypto education & tools</p>
        <div class="footer-links">
            <a href="/about/" data-track="footer_about">About</a>
            <a href="/contact/" data-track="footer_contact">Contact</a>
            <a href="/privacy-policy/" data-track="footer_privacy">Privacy Policy</a>
            <a href="/terms/" data-track="footer_terms">Terms of Use</a>
        </div>
        <p style="margin-top: 1rem; opacity: 0.75;">
            Disclaimer: Not financial advice. Crypto trading involves risk. Data is informational and may be delayed.
        </p>
    </footer>

    <!-- How-To modal (beginner-friendly) -->
    <div class="modal" id="how-modal" aria-hidden="true">
        <div class="modal-backdrop" data-close="how"></div>
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="how-title">
            <div class="modal-header">
                <div>
                    <div class="muted" style="font-weight: 800; letter-spacing: 0.06em; font-size: 0.75rem; text-transform: uppercase;">Beginner Mode</div>
                    <div class="modal-title" id="how-title">How to execute this spread</div>
                </div>
                <button class="modal-close" type="button" data-close="how">Close</button>
            </div>
            <div class="modal-body">
                <div class="muted" id="how-summary">—</div>
                <div class="modal-steps">
                    <div class="step">
                        <div class="num">1</div>
                        <div>
                            <div class="txt">Open accounts on both exchanges</div>
                            <div class="muted">Use the “Open Account” buttons (affiliate links can be added later).</div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="num">2</div>
                        <div>
                            <div class="txt">Buy on the cheaper exchange</div>
                            <div class="muted">Place a market/limit order and confirm your filled price.</div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="num">3</div>
                        <div>
                            <div class="txt">Sell on the more expensive exchange</div>
                            <div class="muted">Keep an eye on fees, slippage, and transfer time.</div>
                        </div>
                    </div>
                </div>
                <div class="muted" style="margin-top: 0.9rem; font-size: 0.85rem;">
                    Disclaimer: spreads can disappear fast. Always do your own research.
                </div>
                <div class="modal-footer">
                    <a class="btn btn-primary" href="#bonuses"><i class="fas fa-gift"></i> Claim Bonuses</a>
                    <a class="btn btn-ghost" href="#learn"><i class="fas fa-graduation-cap"></i> Read Beginner Guides</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getGa4MeasurementId() {
            const meta = document.querySelector('meta[name="coinnavigator-ga4"]');
            const fromMeta = (meta && meta.getAttribute('content')) ? meta.getAttribute('content').trim() : '';
            const p = new URLSearchParams(window.location.search);
            const fromQuery = (p.get('ga4') || '').trim();
            if (fromQuery && fromQuery.startsWith('G-')) {
                localStorage.setItem('coinnavigator_ga4', fromQuery);
            }
            const saved = (localStorage.getItem('coinnavigator_ga4') || '').trim();
            return fromMeta || saved || null;
        }

        function initAnalytics() {
            const id = getGa4MeasurementId();
            if (!id) return;

            // Load gtag.js dynamically (no-op unless you set the meta tag)
            const s1 = document.createElement('script');
            s1.async = true;
            s1.src = `https://www.googletagmanager.com/gtag/js?id=${encodeURIComponent(id)}`;
            document.head.appendChild(s1);

            window.dataLayer = window.dataLayer || [];
            window.gtag = window.gtag || function () { window.dataLayer.push(arguments); };
            window.gtag('js', new Date());
            window.gtag('config', id, { anonymize_ip: true });
        }

        function track(name, params) {
            try {
                if (typeof window.gtag === 'function') {
                    window.gtag('event', name, params || {});
                }
            } catch {}
        }

        function getRegionFromQuery() {
            const p = new URLSearchParams(window.location.search);
            const r = p.get('region');
            return r && ['EU','RU','US','ASIA'].includes(r) ? r : null;
        }

        function guessRegion() {
            try {
                const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
                if (tz.startsWith('Europe/')) return 'EU';
                if (tz.startsWith('Asia/')) return 'ASIA';
                if (tz.startsWith('America/')) return 'US';
            } catch {}
            return 'EU';
        }

        function getRegion() {
            const q = getRegionFromQuery();
            if (q) return q;
            const saved = localStorage.getItem('coinnavigator_region');
            if (saved && ['EU','RU','US','ASIA'].includes(saved)) return saved;
            return guessRegion();
        }

        function setRegion(region) {
            localStorage.setItem('coinnavigator_region', region);
            const lbl = document.getElementById('region-label');
            if (lbl) lbl.textContent = region;
            track('region_set', { region });

            const recMap = {
                EU: [
                    { href: '/binance-review/', text: 'Binance Review' },
                    { href: '/okx-for-beginners/', text: 'OKX for Beginners' },
                    { href: '/bybit-arbitrage/', text: 'Bybit & Arbitrage' },
                ],
                RU: [
                    { href: '/okx-for-beginners/', text: 'OKX for Beginners' },
                    { href: '/bybit-arbitrage/', text: 'Bybit & Arbitrage' },
                    { href: '/binance-review/', text: 'Binance Review' },
                ],
                US: [
                    { href: '/binance-review/', text: 'Binance Review' },
                    { href: '/okx-for-beginners/', text: 'OKX for Beginners' },
                    { href: '/bybit-arbitrage/', text: 'Bybit & Arbitrage' },
                ],
                ASIA: [
                    { href: '/bybit-arbitrage/', text: 'Bybit & Arbitrage' },
                    { href: '/okx-for-beginners/', text: 'OKX for Beginners' },
                    { href: '/binance-review/', text: 'Binance Review' },
                ],
            };

            const btns = [
                document.getElementById('rec-1'),
                document.getElementById('rec-2'),
                document.getElementById('rec-3'),
            ];
            const recs = recMap[region] || recMap.EU;
            btns.forEach((btn, i) => {
                if (!btn) return;
                const base = recs[i] || recs[0];
                const url = new URL(base.href, window.location.origin);
                url.searchParams.set('region', region);
                btn.href = url.pathname + url.search;
                btn.innerHTML = `<i class="fas fa-building-columns"></i> ${base.text}`;
            });

            // Any link marked with data-regionize="1" gets the region param (internal pages only).
            document.querySelectorAll('a[data-regionize="1"]').forEach((a) => {
                try {
                    const u = new URL(a.getAttribute('href'), window.location.origin);
                    if (u.origin !== window.location.origin) return;
                    u.searchParams.set('region', region);
                    a.setAttribute('href', u.pathname + u.search + (u.hash || ''));
                } catch {}
            });
        }

        async function fetchJsonWithFallback() {
            const origins = [
                window.location.origin,
                'https://www.coinnavigator.net',
            ];

            const candidates = [];
            for (const origin of origins) {
                candidates.push(new URL('/spread_data.json', origin).toString());
                candidates.push(new URL('/data/spread_data.json', origin).toString());
            }

            let lastError = null;
            for (const baseUrl of candidates) {
                const url = baseUrl + '?v=' + Date.now();
                try {
                    const res = await fetch(url, { cache: 'no-store' });
                    if (!res.ok) {
                        lastError = new Error(`HTTP ${res.status} for ${baseUrl}`);
                        continue;
                    }
                    return await res.json();
                } catch (e) {
                    lastError = e;
                }
            }
            throw lastError ?? new Error('Failed to fetch spread data');
        }

        async function fetchPolymarketWithFallback() {
            const origins = [
                window.location.origin,
                'https://www.coinnavigator.net',
            ];

            const candidates = [];
            for (const origin of origins) {
                candidates.push(new URL('/polymarket_hot.json', origin).toString());
                candidates.push(new URL('/data/polymarket_hot.json', origin).toString());
            }

            let lastError = null;
            for (const baseUrl of candidates) {
                const url = baseUrl + '?v=' + Date.now();
                try {
                    const res = await fetch(url, { cache: 'no-store' });
                    if (!res.ok) {
                        lastError = new Error(`HTTP ${res.status} for ${baseUrl}`);
                        continue;
                    }
                    return await res.json();
                } catch (e) {
                    lastError = e;
                }
            }
            throw lastError ?? new Error('Failed to fetch polymarket data');
        }

        function fmtUsdShort(v) {
            if (typeof v !== 'number' || Number.isNaN(v)) return '—';
            if (v >= 1_000_000) return '$' + (v / 1_000_000).toFixed(2) + 'M';
            if (v >= 1_000) return '$' + (v / 1_000).toFixed(1) + 'K';
            return '$' + v.toFixed(0);
        }

        function fmtProb(p) {
            if (typeof p !== 'number' || Number.isNaN(p)) return '—';
            return (p * 100).toFixed(1) + '%';
        }

        function buildPolymarketUrl(url, sourceTag) {
            try {
                const u = new URL(url);
                u.searchParams.set('utm_source', 'coinnavigator');
                u.searchParams.set('utm_medium', 'referral');
                u.searchParams.set('utm_campaign', 'polymarket_hot');
                u.searchParams.set('utm_content', sourceTag || 'homepage');
                return u.toString();
            } catch {
                return url;
            }
        }

        function renderPolymarketModule(payload) {
            const grid = document.getElementById('pm-grid');
            const updated = document.getElementById('pm-updated');
            if (!grid) return;

            const markets = (payload && payload.markets) ? payload.markets : [];
            const top = Array.isArray(markets) ? markets.slice(0, 4) : [];

            if (payload && payload.timestamp && updated) {
                const d = new Date(payload.timestamp);
                updated.innerHTML = `<i class="far fa-clock"></i> Polymarket updated: ${d.toLocaleString()}`;
            }

            if (!top.length) {
                grid.innerHTML = `<div class="pm-card"><div class="pm-q">No hot events available right now.</div><div class="pm-meta">Try again in a few minutes.</div></div>`;
                return;
            }

            grid.innerHTML = '';
            top.forEach((m) => {
                const url = buildPolymarketUrl(m.url, 'home_card');
                const card = document.createElement('div');
                card.className = 'pm-card';
                card.innerHTML = `
                    <div class="pm-q">${m.question}</div>
                    <div class="pm-meta">
                        <span><b>${fmtUsdShort(m.volume24hr)}</b> 24h volume</span>
                        <span class="muted">Market probability</span>
                    </div>
                    <div class="pm-chips">
                        <span class="pm-chip">YES: ${fmtProb(m.yes)}</span>
                        <span class="pm-chip">NO: ${fmtProb(m.no)}</span>
                    </div>
                    <div class="pm-actions">
                        <a class="btn-mini btn-mini-primary" href="${url}" target="_blank" rel="noopener noreferrer" title="Analyze this event on Polymarket" data-track="pm_view_market_home" data-slug="${m.slug || ''}"><i class="fas fa-arrow-up-right-from-square"></i> View market</a>
                        <a class="btn-mini" href="/polymarket/" title="See more hot events" data-track="pm_more_events_home"><i class="fas fa-fire"></i> More events</a>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        async function updateDashboard() {
            try {
                console.log('Fetching data...');
                const data = await fetchJsonWithFallback();
                console.log('Data received:', data);

                const tbody = document.getElementById('spread-body');
                const timestampDiv = document.getElementById('timestamp');
                const maxSpreadDiv = document.getElementById('max-spread');
                const assetCountDiv = document.getElementById('asset-count');
                
                tbody.innerHTML = '';
                let highestSpread = 0;
                let count = 0;

                // Separation rule: no direct affiliate URLs from homepage.
                // Homepage should link to internal review pages; review pages contain contextual CTA + (optional) affiliate link.
                const REVIEW_PAGES = {
                    Binance: '/binance-review/',
                    OKX: '/okx-for-beginners/',
                    KuCoin: '/kucoin-review/',
                    Gate: '/gate-review/',
                    MEXC: '/mexc-review/',
                    Bybit: '/bybit-arbitrage/',
                };

                function openHowModal(payload) {
                    const modal = document.getElementById('how-modal');
                    const summary = document.getElementById('how-summary');
                    if (!modal || !summary) return;
                    summary.textContent = payload;
                    modal.classList.add('open');
                    modal.setAttribute('aria-hidden', 'false');
                }

                function closeHowModal() {
                    const modal = document.getElementById('how-modal');
                    if (!modal) return;
                    modal.classList.remove('open');
                    modal.setAttribute('aria-hidden', 'true');
                }

                document.querySelectorAll('[data-close="how"]').forEach((el) => {
                    el.addEventListener('click', closeHowModal);
                });
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') closeHowModal();
                });

                for (const [symbol, info] of Object.entries(data.symbols)) {
                    count++;
                    // Backwards-compatible fallback (older JSON only had binance_price/bybit_price).
                    const prices = (info.prices && Object.keys(info.prices).length)
                        ? info.prices
                        : {
                            Binance: info.binance_price,
                            Bybit: info.bybit_price,
                        };

                    const hasBest = info.best_buy && info.best_sell;
                    const hasSpread = typeof info.spread_percent === 'number' && (hasBest || info.higher_exchange);

                    let displaySpreadText = 'N/A';
                    let spreadDetails = '';
                    if (hasSpread) {
                        const displaySpread = info.spread_percent * 100;
                        displaySpreadText = displaySpread.toFixed(4) + '%';
                        if (displaySpread > highestSpread) highestSpread = displaySpread;
                        if (info.best_buy && info.best_sell) {
                            spreadDetails = `Buy ${info.best_buy.exchange} / Sell ${info.best_sell.exchange}`;
                        } else if (info.higher_exchange) {
                            spreadDetails = `Higher: ${info.higher_exchange}`;
                        }
                    }

                    const fmt = (v) => (typeof v === 'number')
                        ? `$${v.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 8 })}`
                        : 'N/A';

                    const buyText = hasBest ? `${info.best_buy.exchange} • ${fmt(info.best_buy.price)}` : 'N/A';
                    const sellText = hasBest ? `${info.best_sell.exchange} • ${fmt(info.best_sell.price)}` : 'N/A';

                    const buyUrl = hasBest ? (REVIEW_PAGES[info.best_buy.exchange] || '/binance-review/') : '#';
                    const sellUrl = hasBest ? (REVIEW_PAGES[info.best_sell.exchange] || '/binance-review/') : '#';
                    const region = getRegion();
                    const buildReviewUrl = (path) => {
                        const u = new URL(path, window.location.origin);
                        u.searchParams.set('region', region);
                        return u.pathname + u.search;
                    };
                    const buyReviewUrl = hasBest ? buildReviewUrl(buyUrl) : '#';
                    const sellReviewUrl = hasBest ? buildReviewUrl(sellUrl) : '#';
                    const buySignupUrl = buyReviewUrl;
                    const sellSignupUrl = sellReviewUrl;

                    const actionHtml = hasBest
                        ? `<div class="row-actions">
                             <a class="btn-mini btn-mini-primary" href="${buyReviewUrl}" title="Recommended exchange for buy leg: ${info.best_buy.exchange}" data-track="table_buy_review" data-ex="${info.best_buy.exchange}" data-sym="${symbol}"><i class="fas fa-cart-shopping"></i> Buy (review)</a>
                             <a class="btn-mini" href="${sellReviewUrl}" title="Recommended exchange for sell leg: ${info.best_sell.exchange}" data-track="table_sell_review" data-ex="${info.best_sell.exchange}" data-sym="${symbol}"><i class="fas fa-right-left"></i> Sell (review)</a>
                             <a class="btn-mini" href="${buySignupUrl}" title="Why ${info.best_buy.exchange} is recommended" data-aff="signup-buy" data-track="table_exchange_open" data-ex="${info.best_buy.exchange}" data-sym="${symbol}"><i class="fas fa-user-plus"></i> ${info.best_buy.exchange}</a>
                             <a class="btn-mini" href="${sellSignupUrl}" title="Why ${info.best_sell.exchange} is recommended" data-aff="signup-sell" data-track="table_exchange_open" data-ex="${info.best_sell.exchange}" data-sym="${symbol}"><i class="fas fa-user-plus"></i> ${info.best_sell.exchange}</a>
                             <a class="btn-mini" href="#how-it-works" title="Learn how arbitrage works"><i class="fas fa-graduation-cap"></i> Learn</a>
                             <button class="btn-mini" type="button" data-toggle="details"><i class="fas fa-circle-info"></i> Prices</button>
                             <button class="btn-mini" type="button" data-open="how" data-track="table_how" data-sym="${symbol}"><i class="fas fa-wand-magic-sparkles"></i> How</button>
                           </div>`
                        : `<span class="muted">Partial data</span>`;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="symbol-box clickable" data-open="details" title="Click to open price details">
                                <i class="fas fa-coins" style="color: #f7931a"></i>
                                <span class="name">${symbol.replace('USDT', '')}</span>
                            </div>
                        </td>
                        <td class="price-val">${hasBest ? `<a class="link-mini focus-ring" href="${buyReviewUrl}" title="Go to ${info.best_buy.exchange} review (region-aware)"><i class="fas fa-store"></i> ${buyText}</a>` : buyText}</td>
                        <td class="price-val">${hasBest ? `<a class="link-mini focus-ring" href="${sellReviewUrl}" title="Go to ${info.best_sell.exchange} review (region-aware)"><i class="fas fa-store"></i> ${sellText}</a>` : sellText}</td>
                        <td><span class="spread-val clickable" data-open="how" title="${spreadDetails} (click for how)">${displaySpreadText}</span></td>
                        <td>${actionHtml}</td>
                    `;
                    tbody.appendChild(row);

                    // Details row (all exchange prices + any errors)
                    const detailsRow = document.createElement('tr');
                    detailsRow.className = 'details-row';
                    detailsRow.style.display = 'none';
                    const errMap = (data.errors && data.errors[symbol]) ? data.errors[symbol] : null;
                    const exchangeKeys = Object.keys(prices);
                    const detailsItems = exchangeKeys.map((ex) => {
                        const v = prices[ex];
                        const err = errMap && errMap[ex] && typeof v !== 'number' ? errMap[ex] : null;
                        const right = (typeof v === 'number') ? fmt(v) : (err ? `<span class="err">${err}</span>` : 'N/A');
                        return `<div class="details-item"><span class="ex">${ex}</span><span class="val">${right}</span></div>`;
                    }).join('');
                    detailsRow.innerHTML = `<td colspan="5">
                        <div class="details">
                            <div class="muted" style="margin-bottom: 0.75rem;">All observed prices (some exchanges may be temporarily blocked).</div>
                            <div class="details-grid">${detailsItems}</div>
                        </div>
                    </td>`;
                    tbody.appendChild(detailsRow);

                    const toggleBtn = row.querySelector('button[data-toggle="details"]');
                    if (toggleBtn) {
                        toggleBtn.addEventListener('click', () => {
                            detailsRow.style.display = (detailsRow.style.display === 'none') ? '' : 'none';
                        });
                    }

                    const openDetails = () => {
                        detailsRow.style.display = (detailsRow.style.display === 'none') ? '' : 'none';
                    };
                    const symbolBox = row.querySelector('[data-open="details"]');
                    if (symbolBox) symbolBox.addEventListener('click', openDetails);

                    const openHow = () => {
                        if (!hasBest) return;
                        const asset = symbol.replace('USDT', '');
                        const msg = `${asset}: Buy on ${info.best_buy.exchange} at ${fmt(info.best_buy.price)} • Sell on ${info.best_sell.exchange} at ${fmt(info.best_sell.price)} • Spread ${displaySpreadText}`;
                        openHowModal(msg);
                    };

                    const howBtn = row.querySelector('button[data-open="how"]');
                    if (howBtn) howBtn.addEventListener('click', openHow);

                    const spreadBadge = row.querySelector('.spread-val[data-open="how"]');
                    if (spreadBadge) spreadBadge.addEventListener('click', openHow);
                }

                assetCountDiv.innerText = count;
                maxSpreadDiv.innerText = highestSpread > 0 ? (highestSpread.toFixed(3) + '%') : '--';
                track('dashboard_render', { assets: count });
                
                if (data.timestamp) {
                    const date = new Date(data.timestamp);
                    timestampDiv.innerHTML = `<i class="far fa-clock"></i> Last updated: ${date.toLocaleString()}`;
                }
                
            } catch (error) {
                console.error('Detailed Error:', error);
                document.getElementById('spread-body').innerHTML = `<tr><td colspan="5" style="text-align: center; color: var(--danger); padding: 4rem;">
                    <div style="margin-bottom: 10px;">Sync Error: ${error.message}</div>
                    <div style="font-size: 0.7rem; opacity: 0.7;">Make sure data/spread_data.json exists on GitHub</div>
                </td></tr>`;
            }
        }

        // Analytics init (optional) - do this early so we can track region_set and other startup events.
        initAnalytics();

        updateDashboard();
        setInterval(updateDashboard, 60000);

        // Polymarket module init (best-effort)
        (async function initPolymarketModule() {
            try {
                const pm = await fetchPolymarketWithFallback();
                renderPolymarketModule(pm);
            } catch (e) {
                console.warn('Polymarket module failed:', e);
            }
        })();

        // Region selector init
        (function initRegionSelector() {
            const select = document.getElementById('region-select');
            const region = getRegion();
            if (select) {
                select.value = region;
                select.addEventListener('change', () => {
                    setRegion(select.value);
                });
            }
            setRegion(region);
        })();

        // Minimal click tracking for elements that have data-track=""
        document.addEventListener('click', (e) => {
            const el = e.target && e.target.closest ? e.target.closest('[data-track]') : null;
            if (!el) return;
            const name = el.getAttribute('data-track');
            const params = {
                region: getRegion(),
                ex: el.getAttribute('data-ex') || undefined,
                sym: el.getAttribute('data-sym') || undefined,
                slug: el.getAttribute('data-slug') || undefined,
                href: (el.tagName === 'A' && el.getAttribute('href')) ? el.getAttribute('href') : undefined,
            };
            track(name, params);
        });
    </script>
</body>
</html>
